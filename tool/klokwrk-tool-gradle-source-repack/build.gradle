import org.apache.tools.ant.filters.ReplaceTokens

apply plugin: "io.micronaut.application"
apply plugin: "com.github.johnrengelman.shadow"

micronaut {
  testRuntime("spock2")
  enableNativeImage(false)
  processing {
    incremental(true)
    annotations("org.klokwrk.tool.gradle.source.repack.*")
  }
}

application {
  mainClass.set("org.klokwrk.tool.gradle.source.repack.GradleSourceRepackCommand")
}

// Processes resources/version.properties and replaces tokens with provided values.
processResources {
  filteringCharset = "UTF-8"
  filter(ReplaceTokens, tokens: [moduleName: project.name, moduleVersion: project.version])
}

dependencies {
  implementation platform(project(":klokwrk-platform-micronaut"))

  compileOnly "info.picocli:picocli-codegen"
  compileOnly "io.github.classgraph:classgraph"
  compileOnly "org.graalvm.nativeimage:svm"

  implementation "info.picocli:picocli"
  implementation "io.micronaut:micronaut-core"
  implementation "io.micronaut:micronaut-http-client"
  implementation "io.micronaut.picocli:micronaut-picocli"
  implementation "io.reactivex.rxjava2:rxjava"
  implementation "javax.inject:javax.inject"
  implementation "org.codehaus.groovy:groovy"

  testImplementation "com.github.tomakehurst:wiremock-jre8"

  runtimeOnly "ch.qos.logback:logback-classic"
}
