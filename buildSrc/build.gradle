plugins {
  id "groovy-gradle-plugin"
}

repositories {
  mavenCentral()
  gradlePluginPortal()
}

tasks.withType(Test).configureEach {
  setJvmArgs(["-noverify", "-XX:TieredStopAtLevel=1"])
  useJUnitPlatform()
}

gradlePlugin {
  plugins {
    testRetryDisablerPlugin { PluginDeclaration pluginDeclaration ->
      pluginDeclaration.setId("org.klokwrk.gradle.test-retry-disabler")
      pluginDeclaration.setImplementationClass("org.klokwrk.gradle.testretrydisabler.TestRetryDisablerPlugin")
    }
  }
}

dependencies {
  implementation "gradle.plugin.org.barfuin.gradle.taskinfo:gradle-taskinfo:$gradleTaskInfoPlugin"
  implementation "org.gradle:test-retry-gradle-plugin:$gradleTestRetryPluginVersion"
  implementation "org.kordamp.gradle:publishing-gradle-plugin:$gradleKordampPluginVersion"
  implementation "org.springframework.boot:spring-boot-gradle-plugin:$springBootVersion"

  testImplementation("org.spockframework:spock-core:$spockVersion") {
    exclude group: "org.codehaus.groovy"
  }
}
